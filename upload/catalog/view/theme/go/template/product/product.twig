{{ header }}
<div id="product" class="container">
    {% if thumb or images %}
    {% if images %}
        <!-- Swiper -->
        <div class="swiper-container product-details">
            <div class="swiper-wrapper">
                {% for image in images %}
                    <div class="swiper-slide">
                        <img src="{{ image.popup }}" alt="{{ heading_title }}">
                    </div>
                {% endfor %}
            </div>
            <!-- Add Pagination -->
            <div class="swiper-pagination"></div>
        </div>
    {% endif %}

    {% if options %}
        <hr>
        <div class="row">
            <div class="container">
                <div id="alert-container"></div>
            </div>
        </div>
        <h3>{{ text_option }}</h3>
        {% for option in options %}
            {% if option.type == 'select' %}
                <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="col-form-label"
                           for="input-option{{ option.product_option_id }}">{{ option.name }}</label> <select
                            name="option[{{ option.product_option_id }}]"
                            id="input-option{{ option.product_option_id }}" class="form-control">
                        <option value="">{{ text_select }}</option>
                        {% for option_value in option.product_option_value %}
                            <option value="{{ option_value.product_option_value_id }}">{{ option_value.name }}
                                {% if option_value.price %}
                                    ({{ option_value.price_prefix }}{{ option_value.price }})
                                {% endif %} </option>
                        {% endfor %}
                    </select>
                </div>
            {% endif %}
            {% if option.type == 'radio' %}
                <div class="form-group{% if option.required %} required {% endif %}" id="option-container-radio">
                    <label class="col-form-label">{{ option.name }}</label>
                    <div id="input-option{{ option.product_option_id }}">
                        {% for option_value in option.product_option_value %}
                            <div class="form-check form-check-inline">
                                <label><input onclick="onRadioOptionChecked(this)" type="radio"
                                              name="option[{{ option.product_option_id }}]"
                                              value="{{ option_value.product_option_value_id }}"
                                              class="form-check-input d-none"/>
                                    {% if option_value.image %}<img src="{{ option_value.image }}"
                                                                    alt="{{ option_value.name }} {% if option_value.price %} {{ option_value.price_prefix }} {{ option_value.price }} {% endif %}"
                                                                    class="img-thumbnail"/>{% endif %}
                                    {#                                    {{ option_value.name }}#}
                                    {% if option_value.price %}
                                        ({{ option_value.price_prefix }}{{ option_value.price }})
                                    {% endif %}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            {% if option.type == 'checkbox' %}
                <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="col-form-label">{{ option.name }}</label>
                    <div id="input-option{{ option.product_option_id }}"> {% for option_value in option.product_option_value %}
                            <div class="form-check">
                                <label><input type="checkbox" name="option[{{ option.product_option_id }}][]"
                                              value="{{ option_value.product_option_value_id }}"
                                              class="form-check-input"/>
                                    {% if option_value.image %} <img src="{{ option_value.image }}"
                                                                     alt="{{ option_value.name }} {% if option_value.price %} {{ option_value.price_prefix }} {{ option_value.price }} {% endif %}"
                                                                     class="img-thumbnail"/>{% endif %}
                                    {{ option_value.name }}
                                    {% if option_value.price %}
                                        ({{ option_value.price_prefix }}{{ option_value.price }})
                                    {% endif %}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            {% if option.type == 'text' %}
                <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="col-form-label"
                           for="input-option{{ option.product_option_id }}">{{ option.name }}</label> <input type="text"
                                                                                                             name="option[{{ option.product_option_id }}]"
                                                                                                             value="{{ option.value }}"
                                                                                                             placeholder="{{ option.name }}"
                                                                                                             id="input-option{{ option.product_option_id }}"
                                                                                                             class="form-control"/>
                </div>
            {% endif %}
            {% if option.type == 'textarea' %}
                <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="col-form-label"
                           for="input-option{{ option.product_option_id }}">{{ option.name }}</label> <textarea
                            name="option[{{ option.product_option_id }}]" rows="5" placeholder="{{ option.name }}"
                            id="input-option{{ option.product_option_id }}"
                            class="form-control">{{ option.value }}</textarea>
                </div>
            {% endif %}
            {% if option.type == 'file' %}
                <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="col-form-label">{{ option.name }}</label>
                    <button type="button" id="button-upload{{ option.product_option_id }}"
                            data-loading-text="{{ text_loading }}" class="btn btn-light btn-block"><i
                                class="fas fa-upload"></i> {{ button_upload }}</button>
                    <input type="hidden" name="option[{{ option.product_option_id }}]" value=""
                           id="input-option{{ option.product_option_id }}"/>
                </div>
            {% endif %}
            {% if option.type == 'date' %}
                <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="col-form-label"
                           for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                    <div class="input-group date">
                        <input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}"
                               id="input-option{{ option.product_option_id }}" class="form-control"/>
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
            {% endif %}
            {% if option.type == 'datetime' %}
                <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="col-form-label"
                           for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                    <div class="input-group datetime">
                        <input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}"
                               id="input-option{{ option.product_option_id }}" class="form-control"/>
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
            {% endif %}
            {% if option.type == 'time' %}
                <div class="form-group{% if option.required %} required {% endif %}">
                    <label class="col-form-label"
                           for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
                    <div class="input-group time">
                        <input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}"
                               id="input-option{{ option.product_option_id }}" class="form-control"/>
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}

    <div class="row">
        <div class="col-auto align-self-center mb-4">
            <label for="input-quantity" class="col-form-label">{{ entry_qty }}</label>
            <div class="input-group input-group-sm" style="width: 200px">
                <div class="input-group-prepend">
                    <button onclick="decrementQuantity.call(null, 'input-quantity')"
                            class="btn btn-light-grey px-1" type="button"><i
                                class="material-icons">remove</i></button>
                </div>
                <input id="input-quantity" type="text" class="form-control w-35" value="{{ minimum }}" size="2"
                       name="quantity">
                <input type="hidden" name="product_id" value="{{ product_id }}"/>
                <div class="input-group-append">
                    <button onclick="incrementQuantity.call(null, 'input-quantity')"
                            class="btn btn-light-grey px-1" type="button"><i class="material-icons">add</i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <button class="btn btn-sm btn-link p-0"><i class="material-icons md-18">favorite_outline</i></button>
    <a target="_blank" href="{{ share_href }}" class="btn btn-sm btn-default btn-rounded ml-2 text-white"><i
                class="material-icons mb-18 mr-2">share</i>Share</a>
    {#    <div class="badge badge-success float-right mt-1">10% off</div>#}

    {#    <p class="text-secondary my-3 small">#}
    {#        <i class="material-icons text-warning md-18 vm">star</i>#}
    {#        <i class="material-icons text-warning md-18 vm">star</i>#}
    {#        <i class="material-icons text-warning md-18 vm">star</i>#}
    {#        <i class="material-icons text-secondary md-18 vm">star</i>#}
    {#        <i class="material-icons text-secondary md-18 vm">star</i>#}
    {#        <span class="text-dark vm ml-2">Rating 4.2</span> <span class="vm">based on 245 reviews</span>#}
    {#    </p>#}

    <div class="row mt-4">
        <div class="col">
            <h3 class="text-success font-weight-normal mb-0">{{ currency }} {{ price }}</h3>
            <p class="text-secondary text-mute mb-0">{{ weight | number_format(2) }} kg</p>
        </div>
        <div class="col-auto align-self-center">
            <button type="button" id="button-cart" data-loading-text="{{ text_loading }}"
                    class="btn btn-default btn-lg shadow btn-rounded">{{ button_cart }} <i class="material-icons md-18">shopping_cart</i>
            </button>
            {#            <button class="btn btn-lg btn-default shadow btn-rounded" data-toggle="modal" id="button-cart"#}
            {#                    data-target="#addToCartModal">Add <i class="material-icons md-18">shopping_cart</i></button>#}
        </div>
    </div>

    <a href="#" class="text-dark mb-1 mt-2 h6 d-block">
        <h4>{{ heading_title }}</h4>
        <span class="small float-right badge bg-warning d-none">
                    <i class="material-icons h5 mb-0">timer</i>
                    <span id="timer" class="vm">
                        <span id="days"></span><small>d</small>
                        <span id="hrs"></span><small>h</small>
                        <span id="min"></span><small>m</small>
                        <span id="sec"></span><small>s</small>
                    </span>
                </span>

    </a>
</div>
{% endif %}
<script type="text/javascript"><!--
    $('select[name=\'recurring_id\'], input[name="quantity"]').change(function () {
        $.ajax({
            url: 'index.php?route=product/product/getDescription',
            type: 'post',
            data: $('input[name=\'product_id\'], input[name=\'quantity\'], select[name=\'recurring_id\']'),
            dataType: 'json',
            beforeSend: function () {
                $('#recurring-description').html('');
            },
            success: function (json) {
                $('.alert-dismissible, .text-danger').remove();

                if (json['success']) {
                    $('#recurring-description').html(json['success']);
                }
            }
        });
    });
    //--></script>
<script type="text/javascript"><!--
    $('#button-cart').on('click', function () {
        $('#alert-container').html('');

        $.ajax({
            url: 'index.php?route=checkout/cart/add',
            type: 'post',
            data: $('#product input[type=\'text\'], #product input[type=\'hidden\'], #product input[type=\'radio\']:checked, #product input[type=\'checkbox\']:checked, #product select, #product textarea'),
            dataType: 'json',
            beforeSend: function () {
                $('#button-cart').button('loading');
            },
            complete: function () {
                $('#button-cart').button('reset');
            },
            success: function (json) {
                $('.alert-dismissible, .text-danger').remove();
                $('.form-control').removeClass('is-invalid');

                if (json['error']) {
                    if (json['error']['option']) {
                        for (i in json['error']['option']) {
                            var element = $('#input-option' + i.replace('_', '-'));

                            if (element.parent().hasClass('input-group')) {
                                element.parent().after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
                            } else {
                                element.after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
                            }
                        }
                    }

                    if (json['error']['recurring']) {
                        $('select[name=\'recurring_id\']').after('<div class="text-danger">' + json['error']['recurring'] + '</div>');
                    }

                    if (json['error']['quantity']) {
                        $('input[name=\'quantity\']').after('<div class="text-danger">' + json['error']['quantity'] + '</div>');
                    }

                    // Highlight any found errors
                    $('.text-danger').each(function () {
                        var element = $(this).parent().find(':input');

                        if (element.hasClass('form-control')) {
                            element.addClass('is-invalid');
                        }
                    });

                    $('.invalid-tooltip').show();
                }

                if (json['success']) {
                    var html = '<div class="cart-alert alert alert-success">' + json['success'] + '</div>';

                    $('#alert-container').append(html);
                    setTimeout(function () {
                        $('#alert-container').html('');
                    }, 3000);

                    $('#cart').load('index.php?route=common/cart/count');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });
    //--></script>
<script type="text/javascript"><!--
    $('.date').datetimepicker({
        'format': 'YYYY-MM-DD',
        'locale': '{{ datepicker }}',
        'allowInputToggle': true
    });

    $('.time').datetimepicker({
        'format': 'HH:mm',
        'locale': '{{ datepicker }}',
        'allowInputToggle': true
    });

    $('.datetime').datetimepicker({
        'format': 'YYYY-MM-DD HH:mm',
        'locale': '{{ datepicker }}',
        'allowInputToggle': true
    });
    //--></script>
<script type="text/javascript"><!--
    $('button[id^=\'button-upload\']').on('click', function () {
        var element = this;

        $('#form-upload').remove();

        $('body').prepend('<form enctype="multipart/form-data" id="form-upload" style="display: none;"><input type="file" name="file" /></form>');

        $('#form-upload input[name=\'file\']').trigger('click');

        if (typeof timer != 'undefined') {
            clearInterval(timer);
        }

        timer = setInterval(function () {
            if ($('#form-upload input[name=\'file\']').val() != '') {
                clearInterval(timer);

                $.ajax({
                    url: 'index.php?route=tool/upload',
                    type: 'post',
                    dataType: 'json',
                    data: new FormData($('#form-upload')[0]),
                    cache: false,
                    contentType: false,
                    processData: false,
                    beforeSend: function () {
                        $(element).button('loading');
                    },
                    complete: function () {
                        $(element).button('reset');
                    },
                    success: function (json) {
                        $('.text-danger').remove();

                        if (json['error']) {
                            $(element).parent().find('input').after('<div class="text-danger">' + json['error'] + '</div>');
                        }

                        if (json['success']) {
                            alert(json['success']);

                            $(element).parent().find('input').val(json['code']);
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
            }
        }, 500);
    });
    //--></script>
<script type="text/javascript"><!--
    $('#review').delegate('.pagination a', 'click', function (e) {
        e.preventDefault();

        $('#review').fadeOut('slow');

        $('#review').load(this.href);

        $('#review').fadeIn('slow');
    });

    $('#review').load('index.php?route=product/product/review&product_id={{ product_id }}');

    $('#button-review').on('click', function () {
        $.ajax({
            url: 'index.php?route=product/product/write&product_id={{ product_id }}',
            type: 'post',
            dataType: 'json',
            data: $('#form-review').serialize(),
            beforeSend: function () {
                $('#button-review').button('loading');
            },
            complete: function () {
                $('#button-review').button('reset');
            },
            success: function (json) {
                $('.alert-dismissible').remove();

                if (json['error']) {
                    $('#review').after('<div class="alert alert-danger alert-dismissible"><i class="fas fa-exclamation-circle"></i> ' + json['error'] + '</div>');
                }

                if (json['success']) {
                    $('#review').after('<div class="alert alert-success alert-dismissible"><i class="fas fa-check-circle"></i> ' + json['success'] + '</div>');

                    $('input[name=\'name\']').val('');
                    $('textarea[name=\'text\']').val('');
                    $('input[name=\'rating\']:checked').prop('checked', false);
                }
            }
        });
    });

    $(document).ready(function () {
        $('.thumbnails').magnificPopup({
            type: 'image',
            delegate: 'a',
            gallery: {
                enabled: true
            }
        });
    });
    //--></script>
{{ footer }}
<!-- page level script -->
<script>
    $(window).on('load', function () {
        var swiper = new Swiper('.product-details ', {
            slidesPerView: 1,
            spaceBetween: 0,
            pagination: {
                el: '.swiper-pagination'
            }
        });


        /* counter count down script */
        var now = new Date();
        now.setDate(now.getDate() + 2);
        var countDownDate = new Date(now).getTime();

        // Update the count down every 1 second
        var x = setInterval(function () {

            // Get today's date and time
            var now = new Date().getTime();

            // Find the distance between now and the count down date
            var distance = countDownDate - now;

            // Time calculations for days, hours, minutes and seconds
            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Display the result in the element with id="demo"
            document.getElementById("days").innerHTML = days;
            document.getElementById("hrs").innerHTML = hours
            document.getElementById("min").innerHTML = minutes
            document.getElementById("sec").innerHTML = seconds

            // If the count down is finished, write some text
            if (distance < 0) {
                clearInterval(x);
                document.getElementById("timer").innerHTML = "EXPIRED";
            }
        }, 1000);

    });

</script>
</div>

<script type="text/javascript">
    var price = "{{ price }}".replace("$", "");
    var currency = "{{ currency }}";
    var product_id = {{ product_id }};

    $('#addToCartModal').on('show.bs.modal', function () {
        $('#product_cart_qty').each(function (index, node) {
            node.value = "1";
        });
    });

    function closeModal() {
        $('#addToCartModal').modal('hide');
    }

    function addToCart() {
        const qty = getQtyFromInput("product_cart_qty");
        cart.add(product_id, qty, '#button_add_to_cart', 'Add', closeModal);
    }

    function getQtyFromInput(elementId) {
        var qtyInput = document.getElementById(elementId);
        var currValue = parseInt(qtyInput.value) || 1;
        return currValue;
    }

    function updateQuantity(elementId, isIncrement) {
        var qtyInput = document.getElementById(elementId);
        var currValue = getQtyFromInput(elementId);
        var newValue = currValue;
        if (isIncrement) {
            newValue = currValue + 1
        } else if (currValue !== 1) {
            newValue = currValue - 1;
        }
        qtyInput.value = newValue;

        var totalPrice = currency + ' ' + (newValue * price).toFixed(2);
        $("#totalPrice").html(totalPrice);
    }

    var incrementQuantity = function (elementId) {
        updateQuantity(elementId, true);
    };

    var decrementQuantity = function (elementId) {
        updateQuantity(elementId, false);
    };
</script>

<script type="text/javascript">
    function onRadioOptionChecked(radio) {
        console.log(radio.value)
    }
</script>