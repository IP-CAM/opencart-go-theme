{{ header }}
    <div id="checkout-cart" class="container">
        <div class="subtitle h6">
            <div class="d-inline-block">
                {{ heading_title }}<br>
                {% if weight %}
                    <p class="small text-mute">{{ weight }}</p>
                {% endif %}
            </div>
        </div>
        {% if success %}
            <div class="alert alert-success alert-dismissible"><i class="fas fa-check-circle"></i> {{ success }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        {% if error_warning %}
            <div class="alert alert-danger alert-dismissible"><i
                        class="fas fa-exclamation-circle"></i> {{ error_warning }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        <div class="row">
            <div id="content" class="col-12 px-0">
                <ul class="list-group list-group-flush mb-4">
                    {% for product in products %}
                        <li class="list-group-item">
                            <div class="row">
                                <div class="col-auto align-self-center">
                                    <button onclick="cart.remove('{{ product.cart_id }}')"
                                            class="btn btn-sm btn-link p-0 float-right"><i
                                                class="material-icons">remove_circle</i></button>
                                </div>
                                <div class="col-2 pl-0 align-self-center">
                                    <figure class="product-image h-auto"><img src="{{ product.thumb }}"
                                                                              alt="{{ product.name }}"
                                                                              class="vm"></figure>
                                </div>
                                <div class="col px-0">
                                    <a href="{{ product.href }}"
                                       class="text-dark mb-1 h6 d-block">{{ product.name }}</a>
                                    <h5 class="text-success font-weight-normal mb-0">{{ product.price }}</h5>
                                    <p class="text-secondary small text-mute mb-0">1.0 kg <span
                                                class=" text-success ml-2">10% off</span></p>
                                </div>
                                <div class="col-auto align-self-center">
                                    <div class="input-group input-group-sm">
                                        <div class="input-group-prepend">
                                            <button class="btn btn-light-grey px-1" type="button"
                                                    onclick="decrementQuantity.call(null, 'product_cart_{{ product.cart_id }}')">
                                                <i
                                                        class="material-icons">remove</i></button>
                                        </div>
                                        <input id="product_cart_{{ product.cart_id }}" type="text"
                                               class="form-control w-35" placeholder=""
                                               name="quantity[{{ product.cart_id }}]" value="{{ product.quantity }}"
                                               disabled>
                                        <div class="input-group-append">
                                            <button class="btn btn-light-grey px-1" type="button"
                                                    onclick="$.debounce(1000, incrementQuantity).call(null, 'product_cart_{{ product.cart_id }}')">
                                                <i
                                                        class="material-icons">add</i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                    {% for voucher in vouchers %}
                        <tr>
                            <td></td>
                            <td class="text-left">{{ voucher.description }}</td>
                            <td class="text-left"></td>
                            <td class="text-left">
                                <div class="input-group">
                                    <input type="text" name="" value="1" size="1" disabled="disabled"
                                           class="form-control"/>
                                    <div class="input-group-append">
                                        <button type="button" data-toggle="tooltip"
                                                title="{{ button_remove }}"
                                                class="btn btn-danger"
                                                onclick="voucher.remove('{{ voucher.key }}');"><i
                                                    class="fas fa-times-circle"></i></button>
                                    </div>
                                </div>
                            </td>
                            <td class="text-right">{{ voucher.amount }}</td>
                            <td class="text-right">{{ voucher.amount }}</td>
                        </tr>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="row text-center">
                    {% for total in totals %}
                        {% if not loop.last %}
                            <div class="col-4">
                                <p class="text-secondary mb-1 small">{{ total.title }}</p>
                                <h5 class="mb-0">{{ total.text }}</h5>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

            </div>
        </div>
        <div class="card mb-4 border-0 shadow-sm border-top-dashed">
            <div class="card-body text-center">
                {% for total in totals %}
                    {% if loop.last %}
                        <p class="text-secondary my-1">{{ total.title }}</p>
                        <h3 class="mb-0">{{ total.text }}</h3>
                    {% endif %}
                {% endfor %}
                <br>
                <a href="{{ checkout }}" class="btn btn-lg btn-default text-white btn-block btn-rounded shadow"><span>Checkout</span><i
                            class="material-icons">arrow_forward</i></a>
            </div>
        </div>
    </div>
    {{ footer }}
</div>
<script type="text/javascript">
    var updateCart = $.debounce(1000, function (cartId, qty) {
        cart.update(cartId, qty);
    });

    function updateQuantity(elementId, isIncrement) {
        var qtyInput = document.getElementById(elementId);
        var currValue = parseInt(qtyInput.value) || 1;
        var newValue = currValue;
        if (isIncrement) {
            newValue = currValue + 1
        } else if (currValue !== 1) {
            newValue = currValue - 1;
        }
        qtyInput.value = newValue;
        const key = elementId.replace('product_cart_', '');
        updateCart(key, newValue);
    }

    var incrementQuantity = function(elementId) {
        updateQuantity(elementId, true);
    };

    var decrementQuantity = function(elementId) {
        updateQuantity(elementId, false);
    };
</script>
